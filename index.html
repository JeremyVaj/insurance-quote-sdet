<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Jeremy Very Good Insurance Company</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Space Mono font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

  <style>
    .space-mono-regular { font-family:"Space Mono",monospace; font-weight:400; font-style:normal; }
    .space-mono-bold { font-family:"Space Mono",monospace; font-weight:700; font-style:normal; }
    .space-mono-regular-italic { font-family:"Space Mono",monospace; font-weight:400; font-style:italic; }
    .space-mono-bold-italic { font-family:"Space Mono",monospace; font-weight:700; font-style:italic; }

    * { box-sizing: border-box; }
    
    html, body { margin:0; padding:0; font-size:100%; }
    body{
      font-family:"Space Mono",monospace;
      color:#111827;
      display:flex; flex-direction:column; align-items:center;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      /* allow mobile scroll */
      overflow-x:hidden; 
      overflow-y:auto;
      -webkit-overflow-scrolling:touch;
      min-height:100vh;
      padding:30px 20px 20px;
    }
    /* Use small-viewport height on capable browsers to avoid iOS URL bar jumps */
    @supports (height: 100svh) {
      body { min-height: 100svh; }
    }

    /* --- animated bubbles (start below viewport) --- */
    .bubbles{
      position:fixed; inset:0; overflow:hidden; z-index:-1;
      background:
        radial-gradient(circle at 20% 20%,rgba(102,126,234,0.45),transparent 60%),
        radial-gradient(circle at 80% 30%,rgba(118,75,162,0.45),transparent 60%),
        radial-gradient(circle at 50% 80%,rgba(102,126,234,0.35),transparent 70%);
      pointer-events:none;
    }
    .bubble{
      position:absolute; border-radius:50%;
      background:rgba(255,255,255,0.15);
      opacity:0;
      transform:translateY(120vh);
      animation:rise linear infinite;
      will-change:transform,opacity;
    }
    @keyframes rise{
      0%   { transform:translateY(120vh) scale(0.6); opacity:0; }
      12%  { opacity:0; }
      20%  { opacity:0.5; }
      100% { transform:translateY(-20vh) scale(1.2); opacity:0; }
    }
    .bubble:nth-child(1){ width:80px;  height:80px;  left:10%; animation-duration:26s; animation-delay:0s; }
    .bubble:nth-child(2){ width:40px;  height:40px;  left:30%; animation-duration:22s; animation-delay:3s; }
    .bubble:nth-child(3){ width:60px;  height:60px;  left:55%; animation-duration:27s; animation-delay:6s; }
    .bubble:nth-child(4){ width:100px; height:100px; left:70%; animation-duration:30s; animation-delay:2s; }
    .bubble:nth-child(5){ width:50px;  height:50px;  left:85%; animation-duration:24s; animation-delay:8s; }
    .bubble:nth-child(6){ width:120px; height:120px; left:15%; animation-duration:32s; animation-delay:12s; }
    .bubble:nth-child(7){ width:90px;  height:90px;  left:45%; animation-duration:28s; animation-delay:16s; }
    .bubble:nth-child(8){ width:70px;  height:70px;  left:65%; animation-duration:25s; animation-delay:20s; }
    .bubble:nth-child(9){ width:60px;  height:60px;  left:80%; animation-duration:26s; animation-delay:10s; }
    .bubble:nth-child(10){width:100px; height:100px; left:40%; animation-duration:33s; animation-delay:14s; }

    header{text-align:center; margin-bottom:20px; line-height:1.1;}
    header h1{
      font-size:3.2rem; margin:0;
      background:linear-gradient(135deg,#ffffff 0%,#dcd3ff 40%,#b09aff 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    }
    header h2{ margin:8px 0 0; font-size:1.6rem; color:#f4f4ff; font-weight:400; }

    .card{
      width:100%; max-width:920px;
      background:rgba(255,255,255,0.93);
      border-radius:20px; padding:28px;
      box-shadow:0 28px 80px rgba(0,0,0,0.25);
      backdrop-filter:blur(12px);
    }

    h3{ margin:0 0 10px; font-size:24px; color:#1e1e1e; }
    h3 span{ background:linear-gradient(135deg,#667eea,#764ba2);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .sub{ color:#6b7280; margin-bottom:18px; font-size:14px; }

    fieldset{ border:0; padding:0; margin:0 0 16px; }
    label{ display:block; margin:10px 0 6px; color:#374151; font-size:14px; }

    select, input[type="number"]{
      width:100%; padding:12px 14px;
      border:2px solid #e5e7eb; border-radius:12px;
      font-size:16px; background:#fff;
      transition:border-color .2s, box-shadow .2s;
      font-family:"Space Mono",monospace;
      box-sizing:border-box; /* Ensure padding/border included in width */
    }
    select:focus, input[type="number"]:focus{
      outline:none; border-color:#667eea;
      box-shadow:0 0 0 3px rgba(102,126,234,0.15);
    }

    .notice{ background:#eef2ff; border-left:5px solid #4f46e5;
      padding:10px 12px; border-radius:12px; color:#1e3a8a; font-size:13px; }
    .warn{ background:#fff7ed; border-left-color:#f59e0b; color:#7c2d12; }

    .coverage{ display:none; margin-top:8px; }
    .coverage.visible{ display:block; }
    .coverage-option{
      display:flex; gap:10px; align-items:center;
      border:2px solid #e5e7eb; border-radius:12px;
      padding:10px 12px; margin:8px 0; cursor:pointer; transition:all .2s;
    }
    .coverage-option:hover{ border-color:#667eea; background:#f7f9ff; }
    .coverage-option label{ margin:0; font-size:14px; }

    .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .row > div { min-width: 0; } /* Prevents grid children from overflowing */
    @media(max-width:760px){ .row{ grid-template-columns:1fr; } }

    .btn{
      display:block; width:100%; padding:14px;
      font-weight:700; color:#fff;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      border:0; border-radius:12px; cursor:pointer;
      transition:transform .2s, opacity .2s; font-size:1.1rem;
    }
    .btn:hover{ transform:translateY(-2px); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }

    .result, .error, .loading{
      display:none; margin-top:16px;
      border-radius:12px; padding:12px 14px;
    }
    .result.show{ display:block; background:#ecfeff; border-left:5px solid #06b6d4; }
    .error.show{ display:block; background:#fef2f2; border-left:5px solid #ef4444; color:#991b1b; }
    .loading.show{ display:block; background:#eef2ff; border-left:5px solid #4f46e5; color:#312e81; }
    .premium{ font-size:28px; color:#0ea5e9; font-weight:700; }
    .muted{ font-size:13px; color:#6b7280; }

    footer{
      margin:20px 0 0;
      text-align:center;
      font-size:12px;
      color:#d1d5db;
      width:100%;
      max-width:920px;
    }
    footer a{ color:#a5b4fc; text-decoration:none; }
  </style>
</head>
<body>
  <div class="bubbles">
    <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
    <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
  </div>

  <header>
    <h1 class="space-mono-bold">Jeremy</h1>
    <h2 class="space-mono-regular-italic">Jeremy Very Good Insurance Company</h2>
  </header>

  <main class="card">
    <h3 class="space-mono-bold-italic"><span>Insurance Quote & Coverage</span></h3>
    <div class="sub space-mono-regular-italic">"Get a very good quote from a very good guy named Jeremy."</div>

    <form id="quoteForm" novalidate>
      <fieldset>
        <label for="state" class="space-mono-regular-italic">Customer State</label>
        <select id="state" required aria-label="Customer state">
          <option value="">-- Select State --</option>
          <option value="WI">Wisconsin (WI)</option>
          <option value="OH">Ohio (OH)</option>
          <option value="IL">Illinois (IL)</option>
          <option value="NV">Nevada (NV)</option>
          <option value="TX">Texas (TX)</option>
          <option value="NY">New York (NY)</option>
          <option value="CA">California (CA)</option>
        </select>
        <div id="v1Notice" class="notice warn" style="display:none" role="alert" aria-label="Coverage unavailable notice">
          Sorry, new coverages aren't available where you live — but your quote will still be very good!
        </div>
      </fieldset>

      <fieldset id="coverageFieldset" class="coverage" aria-hidden="true" role="radiogroup" aria-label="Coverage options">
        <div class="notice space-mono-regular-italic" style="margin-bottom:10px" aria-label="Coverage available notice">
          Lucky you! New coverage options are available in your state.
        </div>
        <div class="coverage-option">
          <input type="radio" id="cov-none" name="coverage" value="none" checked aria-label="Coverage none" />
          <label for="cov-none"><strong>None</strong> — No additional coverage</label>
        </div>
        <div class="coverage-option">
          <input type="radio" id="cov-silver" name="coverage" value="silver" aria-label="Coverage silver" />
          <label for="cov-silver"><strong>Silver</strong> — Basic coverage package</label>
        </div>
        <div class="coverage-option">
          <input type="radio" id="cov-gold" name="coverage" value="gold" aria-label="Coverage gold" />
          <label for="cov-gold"><strong>Gold</strong> — Enhanced coverage package</label>
        </div>
        <div class="coverage-option">
          <input type="radio" id="cov-platinum" name="coverage" value="platinum" aria-label="Coverage platinum" />
          <label for="cov-platinum"><strong>Platinum</strong> — Premium coverage package</label>
        </div>
      </fieldset>

      <fieldset class="row">
        <div>
          <label for="business" class="space-mono-regular-italic">Business Type</label>
          <select id="business" required aria-label="Business type">
            <option value="">-- Select Business Type --</option>
            <option value="retail">Retail</option>
            <option value="restaurant">Restaurant</option>
            <option value="professional">Professional Services</option>
            <option value="manufacturing">Manufacturing</option>
          </select>
        </div>
        <div>
          <label for="revenue" class="space-mono-regular-italic">Annual Revenue ($)</label>
          <input type="number" id="revenue" inputmode="numeric" min="0" placeholder="50000" required aria-label="Annual revenue" />
        </div>
      </fieldset>

      <button type="submit" class="btn" id="submitButton" disabled aria-label="Submit quote">
        Get Quote
      </button>

      <div class="loading" id="loading" role="status" aria-live="polite" aria-label="Loading">
        Calculating your quote…
      </div>

      <section class="result" id="quoteResult" role="region" aria-label="Quote result">
        <div class="space-mono-bold-italic" style="margin-bottom:6px;">Your Insurance Quote</div>
        <div class="premium space-mono-bold" aria-label="Premium amount">$0.00</div>
        <div class="muted space-mono-regular-italic">Annual Premium</div>
        <div class="muted" aria-label="Quote ID"></div>
        <div class="muted" aria-label="Quote timestamp"></div>
      </section>

      <div class="error" id="error" role="alert" aria-label="Error message">
        <strong>Error:</strong> <span id="errorText"></span>
      </div>
    </form>
  </main>

  <footer>
    <em>
      For more information about purchasing your quoted price, contact Jeremy at 
      <a href="https://jeremyvajko.com">JeremyVajko.com</a>
    </em>
  </footer>

  <script>
    const V2=['WI','OH','IL','NV'],V1=['TX','NY','CA'];
    const API='https://rating-api.jeremy-vajko.workers.dev/';
    const f=document.getElementById('quoteForm'),
          s=document.getElementById('state'),
          b=document.getElementById('business'),
          r=document.getElementById('revenue'),
          btn=document.getElementById('submitButton'),
          c=document.getElementById('coverageFieldset'),
          n=document.getElementById('v1Notice'),
          load=document.getElementById('loading'),
          res=document.getElementById('quoteResult'),
          prem=res.querySelector('[aria-label="Premium amount"]'),
          qid=res.querySelector('[aria-label="Quote ID"]'),
          ts=res.querySelector('[aria-label="Quote timestamp"]'),
          err=document.getElementById('error'),
          errTxt=document.getElementById('errorText');

    function covVal(){const x=document.querySelector('input[name="coverage"]:checked');return x?x.value:null;}
    function showHide(){
      const val=s.value;
      if(V2.includes(val)){c.classList.add('visible');c.setAttribute('aria-hidden','false');n.style.display='none';}
      else if(V1.includes(val)){c.classList.remove('visible');c.setAttribute('aria-hidden','true');n.style.display='block';}
      else{c.classList.remove('visible');c.setAttribute('aria-hidden','true');n.style.display='none';}
      toggleBtn();
    }
    function toggleBtn(){
      // V2 states need coverage selected, V1 states don't
      const hasAllFields = s.value!=='' && b.value!=='' && r.value!=='' && Number(r.value)>=0;
      
      if(V2.includes(s.value)){
        // V2 state: require coverage selection
        btn.disabled = !(hasAllFields && covVal());
      } else if(V1.includes(s.value)){
        // V1 state: just need basic fields
        btn.disabled = !hasAllFields;
      } else {
        // No state selected
        btn.disabled = true;
      }
    }
    [s,b,r].forEach(el=>el.addEventListener('input',toggleBtn));
    s.addEventListener('change',showHide);
    document.querySelectorAll('input[name="coverage"]').forEach(x=>x.addEventListener('change',toggleBtn));
    f.addEventListener('submit',async e=>{
      e.preventDefault();
      res.classList.remove('show');err.classList.remove('show');load.classList.add('show');
      const payload={revenue:Number(r.value),state:s.value,business:b.value};
      try{
        const resp=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
        const data=await resp.json();load.classList.remove('show');
        if(resp.ok){
          prem.textContent=`$${Number(data.premium).toFixed(2)}`;
          qid.textContent=`Quote ID: ${data.quoteId||''}`;
          ts.textContent=data.calculatedAt?`Generated: ${new Date(data.calculatedAt).toLocaleString()}`:'';
          res.classList.add('show');
        }else{
          errTxt.textContent=data.message||data.error||'Request failed';err.classList.add('show');
        }
      }catch{
        load.classList.remove('show');errTxt.textContent='Network error';err.classList.add('show');
      }
    });
    showHide();toggleBtn();
  </script>
</body>
</html>
